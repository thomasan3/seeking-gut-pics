<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Upload Photo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 30px; background:#111; color:#fff; }
    h1 { margin-bottom: 20px; }
    input { margin: 20px 0; }
    img { max-width: 92%; margin-top: 18px; border-radius: 10px; display:none; }
    button { padding: 12px 20px; font-size: 16px; border:none; border-radius: 8px; cursor:pointer; margin: 10px; }
    .upload-btn { background:#4CAF50; color:#fff; }
    .retake-btn { background:#f44336; color:#fff; }
    #status { margin-top: 18px; font-weight: bold; }
  </style>
</head>

<body>
  <h1>Upload Photo</h1>

  <input type="file" id="fileInput" accept="image/*" capture="environment" />
  <br />
  <img id="preview" />
  <br />
  <button class="upload-btn" id="uploadBtn">Upload</button>
  <button class="retake-btn" id="retakeBtn">Retake</button>

  <div id="status"></div>

  <!-- ✅ Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-storage-compat.js"></script>

  <script>
    // ✅ 1) Paste YOUR firebaseConfig here (from Firebase console > Project settings > Web app)
const firebaseConfig = {
  apiKey: "AIzaSyAGBk_qMddYXMl24Em8J_IGb6GxQxQeBa4",
  authDomain: "seeking-gut.firebaseapp.com",
  databaseURL: "https://seeking-gut-default-rtdb.firebaseio.com",
  projectId: "seeking-gut",
  storageBucket: "seeking-gut.firebasestorage.app",
  messagingSenderId: "934480362973",
  appId: "1:934480362973:web:5a29fdb02e794f88e88a34",
  measurementId: "G-CXXNYWC665"
};

    firebase.initializeApp(firebaseConfig);
    const storage = firebase.storage();

    // ✅ Always overwrite this single file:
    const FILE_PATH = "latest.png";

    let selectedFile = null;
    let lastUploadTime = 0;

    const fileInput = document.getElementById("fileInput");
    const preview = document.getElementById("preview");
    const statusEl = document.getElementById("status");

    fileInput.addEventListener("change", (event) => {
      selectedFile = event.target.files[0];
      if (!selectedFile) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        preview.src = e.target.result;
        preview.style.display = "block";
      };
      reader.readAsDataURL(selectedFile);
    });

    document.getElementById("retakeBtn").addEventListener("click", () => {
      fileInput.value = "";
      preview.src = "";
      preview.style.display = "none";
      statusEl.innerText = "";
      selectedFile = null;
    });

    document.getElementById("uploadBtn").addEventListener("click", async () => {
      const now = Date.now();
      if (now - lastUploadTime < 3000) {
        statusEl.innerText = "Please wait a few seconds before uploading again.";
        return;
      }

      if (!selectedFile) {
        statusEl.innerText = "No image selected.";
        return;
      }

      try {
        statusEl.innerText = "Uploading...";
        document.getElementById("uploadBtn").disabled = true;

        const fileRef = storage.ref().child(FILE_PATH);

        // Overwrite latest.png
        await fileRef.put(selectedFile, { contentType: selectedFile.type });

        // Get a URL you can paste into Unity to test
        const url = await fileRef.getDownloadURL();

        statusEl.innerText = "Upload successful ✅";
        console.log("DOWNLOAD URL (paste into Unity):", url);

        lastUploadTime = Date.now();
      } catch (err) {
        console.error(err);
        statusEl.innerText = "Upload failed ❌ " + (err?.message || "");
      } finally {
        document.getElementById("uploadBtn").disabled = false;
      }
    });
  </script>
</body>
</html>
